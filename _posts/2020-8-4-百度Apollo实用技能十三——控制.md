---
title: 控制
tags:
  - 百度
  - 无人驾驶
---

# Apollo 感知算法

### 控制理论

- 控制模块的输入一方面来自planning（规划模块），另一方面来自反馈阶段信息（如localization和HD Map）（定位与高精地图）
- 其输出结果是控制指令，与下层模块Canbus（车辆交互标准）进行交互
- 同时控制模块也会从底层车辆得到反馈信号：速度信息、四轮转速信息、车辆健康状况信息、底盘是否报错信息、危险信息

### 控制模块

- 控制模块包括三个部分：预处理、控制器和后处理
- 预处理部分的主要功能包括三方面：
  - 第一是对输入信号的检查，对不正常信号的过滤
  - 第二是做一些紧急处理
  - 第三是做一些滤波操作，例如信号的平滑等
- 控制器主要功能包括：模型建立、系统识别和分析，控制器/观察器设计以及参数调优等功能
- 后处理部分将信号发送给执行器，包括限制的处理以及信号滤波
  - 因为油门、刹车、转向这种执行器本身有上下限、滞后（回滞曲线），所以需要对信号进行一些相关处理

- 控制主要是为了弥补数学模型和物理世界执行之间的不一致性

- 对于自动驾驶而言，规划的轨迹和车辆的实际运行轨迹并不完全一致，控制器按照规划轨迹在条件允许下尽可能地调节车辆本身
- 为了能够安全、舒适的行驶，自动驾驶系统对性能的要求需要控制模块，主要体现在以下几个方面
  - 首先是稳定性，包括在所有场景下的车辆行为稳定和安全。
  - 其次是稳定状态的行为，减少或者消除规划和实际车辆行为的差别。
  - 最后是瞬时状态的行为。
- 自动驾驶系统是否满足性能要求可以从三个角度去评测：时域、频域以及discrete domain（离散域）
- 时域是指输出在时间轴上应该满足的要求
  - 其衡量的指标包括steady state gain、rising time、setting time、overshoot和undershoot
- 系统在频域里也需要满足一定的要求
  - 在频域空间，X轴是输入频率，Y轴是输出跟输入的比例，理想状态下输出和输入比例应该为1
  - 系统性能在频域中的评价指标包括pass band、cutoff frequency等

- 最简单的控制器就是PID控制器，即比例、积分、微分控制，它是一个model free的控制方法

- PID控制的基本原理：
  - U是参考量，它和反馈信号之间的差距用error表示
  - 比例控制P的意思是该控制量与误差成比例，用kp*e(t) 表示
  - 当kp比较小的时候，接近终值的速度会非常慢，如右图的红线所示，但是它有超调与undershoot现象
  - 当kp设置比较大时，则达到稳态速度变快，但会超调，如右图紫色曲线所示
  - 如果系统中存在损耗，比如汽车上坡的动力或者摩擦损耗，使得比例控制每次增加的控制量就等于或者小于损耗时，出现稳态误差，这就是引入积分控制的目的，它可以将之前的误差进行积分，消除稳态误差
  - 微分控制的目的是使系统更快的从瞬态转化为稳态

### 基于模型的控制方法

#### 建模

- 建模一般分为分析建模和拟合建模

- 通常，一个模型由各种属性表示，主要包括描述输入输出的数量、模型是线性还是非线性、连续或离散等特性

- 控制模块中的模型，通常包括运动学模型和动力学模型

- 运动学模型是一种几何模型，运动学模型是动力学模型的一个子集

- 感知、预测讨论的模型则以运动学模型为主，在控制模块中，更多考虑动力学模型

- 在自动驾驶中，Model以运动学模型（Kinematics model）为初始模型，将环境等参数设置到运动学模型中，把车看作质点进行分析

  ##### 几何模型

  - 综合移动机器人控制模型
  - 自行车模型
  - 不能只考虑几何约束，一个优秀的几何模型，它不仅要考虑几何约束，还要考虑力矩和扭矩平衡

- 通常情况下，模型的建立是基于误差，而不是参考值
- 在控制器实现过程中，通常会将ODE或者PDE方程进行处理，转化为矩阵计算的形式

### 系统辨识

- 在模型中，有些参数是未知的，系统辨识的目的是确定这些未知参数的值
- 确定未知参数的方法有三种：
  - 白盒方法是指对于基于第一原理（如牛顿定律）的模型结构，可以由测量数据估计模型的参数。
  - 灰盒方法是用于**仅有部分模型结构可知**，通过数据重建的方法来获取模型的其它部分的方法。
  - 黑盒方法是指模型结构和参数都在未知的情况下，**只能通过输入输出数据**来估计的方法。
- 基于学习的辨识方法和黑盒方法很类似

### 控制器设计

- 基于模型的控制模块设计第三步是控制器的设计，包括滤波器设计、控制器设计以及观察器设计等
- 滤波器可以分为线性和非线性，数字滤波或者模拟信号滤波，离散滤波或者连续滤波等
- 系统在频域里面需要满足某些性能要求，滤波器通常也会对频域信号进行处理：根据频域边界，我们可以对滤波器进行进一步细分，包括低通滤波，高通滤波等
- 根据实现方式不同，滤波器又可以分为高斯滤波、卡尔曼滤波、贝叶斯滤波等，这些滤波器通常用于预测和跟踪